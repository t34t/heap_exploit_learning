## Change glibc version and add symbol debug

glibc source debug tutorial,somtimes we use old version glibc and symbol: https://www.jianshu.com/p/1a966b62b3d4

https://patchwork.ozlabs.org/project/glibc/patch/20170623161158.GA5384@gmail.com/


Example:

```
wget https://ftp.gnu.org/gnu/glibc/glibc-2.23.tar.gz
tar xvf glibc-2.23.tar.gz 

cd glibc-2.23
mkdir build
cd build

CFLAGS="-g -g3 -ggdb -gdwarf-4 -Og -w" CXXFLAGS="-g -g3 -ggdb -gdwarf-4 -Og -w" ../configure --prefix=/home/user/Desktop/glibc-2.23/64

make && make install
```

if error like:

```
/tmp/ccPRCqlU.s: Error: `loc1@GLIBC_2.2.5' can't be versioned to common symbol 'loc1'
/tmp/ccPRCqlU.s: Error: `loc2@GLIBC_2.2.5' can't be versioned to common symbol 'loc2'
/tmp/ccPRCqlU.s: Error: `locs@GLIBC_2.2.5' can't be versioned to common symbol 'locs'
```
patch regexp.c some diff like:
```
diff --git a/misc/regexp.c b/misc/regexp.c
index 19d76c0..9017bc1 100644
--- a/misc/regexp.c
+++ b/misc/regexp.c
@@ -29,14 +29,17 @@ 
 
 #if SHLIB_COMPAT (libc, GLIBC_2_0, GLIBC_2_23)
 
-/* Define the variables used for the interface.  */
-char *loc1;
-char *loc2;
+#include <stdlib.h>	/* Get NULL.  */
+
+/* Define the variables used for the interface.  Avoid .symver on common
+   symbol, which just creates a new common symbol, not an alias.  */
+char *loc1 = NULL;
+char *loc2 = NULL;
 compat_symbol (libc, loc1, loc1, GLIBC_2_0);
 compat_symbol (libc, loc2, loc2, GLIBC_2_0);
 
 /* Although we do not support the use we define this variable as well.  */
-char *locs;
+char *locs = NULL;
 compat_symbol (libc, locs, locs, GLIBC_2_0);
```
After make install

test sample:
```
// hello.c
# include<stdio.h>
int main() {
    printf("hello world");
    return 0;
}
gcc hello.c -o hello -g
gdb hello
b printf
c
```
![Alt text](image-7.png)


use patchelf change ld in elf

```
patchelf --set-interpreter /home/user/Desktop/glibc-2.23/64/lib/ld-2.23.so hello
gdb hello 
b printf
c
```
then we can use symbol debug as time as change glibc version
![Alt text](image-8.png)
