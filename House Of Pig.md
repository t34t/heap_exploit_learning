## House Of Pig

House of Pig 是一个将 Tcache Stash Unlink+ Attack 和 FSOP 结合的攻击，同时使用到了 Largebin Attack 进行辅助。主要适用于 libc 2.31 及以后的新版本 libc 并且程序中仅有 calloc 时。

利用条件为

存在 UAF
能执行 abort 流程或程序显式调用 exit 或程序能通过主函数返回。
主要利用的函数为 _IO_str_overflow，可以参考 glibc 2.24 下 IO_FILE 的利用。

利用流程为

进行一个 Tcache Stash Unlink+ 攻击，把地址 __free_hook - 0x10 写入 tcache_pthread_struct。由于该攻击要求 __free_hook - 0x8 处存储一个指向可写内存的指针，所以在此之前需要进行一次 large bin attack。
再进行一个 large bin attack，修改 _IO_list_all 为一个堆地址，然后在该处伪造 _IO_FILE 结构体。
通过伪造的结构体触发 _IO_str_overflow getshell。